# 06. 가상 네트워크 서비스 Amazon VPC

### 1. Amazon VPC란: AWS에 생성하는 가상 네트워크

1. Amazon VPC란
   - Amazon Virtual Private Cloud
   - AWS 계정 전용 가상 네트워크 서비스로, AWS에서 제공하는 리소스만 설치할 수 있다.
2. VPC의 구성
   - VPC 내에 서버를 설치하면 해당 네트워크에 소속되지만, 별도로 설정하지 않는다면 VPC 자체는 격리된 네트워크가 된다.
   - 외부와 통신하려면 VPC를 인터넷 혹은 회사 내 LAN과 연결해야 한다.
3. vpc의 기능
   - CIDR 블록: 서브넷, 네트워크를 나눈 범위. VPC를 생성할 때 네트워크 범위를 CIDR로 정하고 이를 더 작은 서브넷으로 나누어 사용한다.
   - 서브넷 마스크: 네트워크의 크기를 계산하는 값. CIDR은 서브넷 마스크의 표기법 중 하나
   - 가용 영역: 서브넷이 구축된 물리적 장소
   - 인터넷 게이트웨이: 인터넷에 접속하기 위한 출입구, VPC를 인터넷에 연결하지 않을 경우에는 불필요하다.
   - 라우팅: 어떤 데이터를 어디에 보낼지 조정한다. 인터넷 게이트웨이와 라우팅으로 데이터 송수신을 설정하지 않으면 VPC가 인터넷과 접속되지 않는다.
   - 라우팅 테이블: 라우팅에 대한 설정이 기록된 테이블
   - 보안 그룹: AWS가 제공하는 가상 방화벽. 인스턴스 단위로 설정하며 유입 데이터는 '거부'가 기본 설정
   - 네트워크 ACL: AWS가 제공하는 가상 방화벽. 서브넷 단위로 설정
4. VPC 네트워크의 특징과 라우팅 테이블
   - VPC는 물리적인 라우터가 아닌 소프트웨어가 라우터 역할을 하며 라우팅을 수행한다.
   - VPC 네트워크의 특장
     - 소프트웨어가 라우팅한다. 라우터는 IP 주소를 갖지 않는다.
     - 라우팅 테이블 한 개에 서브넷 여러 개를 설정할 수 있다.
     - VPC 한 개에 인터넷 게이트웨이는 한 개만 설정할 수 있고, IP 주소를 갖지 않는다.
     - 서브넷 사이의 통신은 라우터 없이 직접 통신할 수 있다.



### 2. VPC의 사용 절차: 가상 네트워크를 사용하자

1. VPC 설정을 위해 꼭 필요한 사항
   - 인터넷 연결 여부와 오토 스케일링
2. VPC 사용 절차
   1. VPC 이름을 정하고 CIDR 블록에 네트워크 범위를 설정한다.
   2. 네트워크를 작게 서브넷으로 나눈다.
   3. 인터넷에 접속하려면 인터넷 게이트웨이를 생성하고 라우팅을 설정(라우팅 테이블과 매핑)해야 한다.
   4. 보안 설정(보안 그룹, 네트워크 ACL)해야 한다.



### 3. 기본 VPC: AWS가 제공하는 기본 VPC

1. 기본 VPC
2. 기본 VPC의 구성
   - 서브넷 + 인터넷 게이트웨이



### 4. 서브넷과  DHCP: 사용할 범위 선택

1. 서브넷이란
   - 커다란 네트워크를 작게 나눈 네트워크
2. 네트워크의 범위와 CIDR 표기
   - CIDR(Classless Inter-Domain Routing): 네트워크와 서브넷의 범위를 나누는 데 사용되는 표기법
3. 네트워크 클래스
   - 규모에 따라서 A, B, C 세 클래스가 있다.
4. IP 주소 할당과 DHCP
   - 네트워크 및 서브넷에 사용되는 IP 주소의 범위는 관리자가 설정할 수 있고, DHCP(Dynamic Host Configuration Protocol)에서 각 호스트(인스턴스)에 IP 주소를 자동으로 할당한다. VPC에는 DHCP 서버가 동작하고 있어 인스턴스가 추가되면 해당 서브넷 범위의 IP 주소 중에 하나가 할당된다. VPC가 일반적으로 사용하는 IP 주소는 사설 IP 주소이다.



### 5. 라우팅과 NAT: 공인 IP 주소와 사설 IP 주소 변환

1. 네트워크와 라우팅

   - 네트워크: PC 여러 대가 서로 통신할 수 있도록 연결되어 있는 상태
     - LAN, WAN, 인터넷으로 연결해 라우터를 통해 데이터를 주고 받는다.

   - 라우팅: PC가 여러 대 있는 환경에서 데이터를 라우터로 보내면 라우터가 목적지로 보내는 방식

2. IP 주소와 게이트웨이

   - IP 주소: 라우터가 각 PC에 데이터를 전달하기 위해 필요한 대상을 식별할 수 있는 주소
   - 라우터는 네트워크의 관문에 위치해 있기 때문에 게이트웨이라고도 한다.

3. IP 마스커레이드
   - LAN에서 인터넷으로 데이터를 전송할 때 LAN 내부의 출입구가 되는 것에 게이트웨이 (실제 기기는 라우터)
   - IP 마스커레이드(NAPT): 게이트웨이가 사설 IP 주소를 공인 IP 주소로 변환하고 가정 내에서 혹은 회사 내에서는 공인 IP 주소를 공동으로 사용하는데, 주소 변환을 담당하는 것이 IP 마스커레이드
4. NAT
   - IP 마스커레이드를 사용하면 내부에서 외부로 나가는 것은 가능하 지만, 외부에서 내부로 들어오는 것은 불가능하다. IP 마스커레이드는 내부에서 외부로 요청하는 것에는 응답하지만, 외부에서 내부로 요청하는 것에는 응답하지 않기 때문
   - IP 마스커레이드는 공인 IP 하나만 설정할 수 있기 때문에 서버가 여러 대라면 공인 IP 주소를 여러 개 설정할 수 있는 NAT(Network Address Translation)를 사용해야 한다.



### 6. 인터넷 게이트웨이와 NAT 게이트웨이: VPC에서 인터넷으로 접속

1. 인터넷 게이트웨이
   - 인터넷 연결을 담당
   - EC2 인스턴스에 웹 사이트를 설치했을 때 웹 사이트에 접속하는 사람은 그 페이지에 접속하고 싶다는 요청을 보낸다. 해당 요청은 DNS에서 변환되어 목적지인 공인 IP 주소로 전달된다. 하지만 EC2 인스턴스는 사설 IP 주소밖에 설정할 수 없기 때문에 요청된 EC2 인스턴스의 연결 정보를 가지고 있는 인터넷 게이트웨이가 공인 IP 주소(목적지)를 사설 IP 주소로 변환하여 해당 EC2 인스턴스에 요청을 보낸다.
2. NAT 게이트웨이
   - 회사 내부에서만 사용하는 서버를 인터넷으로 연결해야 할 때 NAT 게이트웨이를 사용한다.
   - 서브넷에서 인터넷으로 접속할 수 있지만, 인터넷에서 서브넷으로 접속하지 못 하게 한다.



### 7. 보안 그룹과 네트워크 ACL: 보안 설정

1. 보안 그룹과 네트워크 ACL
   - VPC의 가상 방화벽으로 보안 그룹과 네트워크 ACL이 있다.
   - 방화벽: 네트워크 통신을 제어하는 방식
   - 보안 그룹과 네트워크 ACL: 인바운드 트래픽(데이터 유입)과 아웃바운드 트래픽(데이터 유출)을 제어
     - 보안 그룹
       - 인스턴스에 대해 설정
       - 규칙 허용만 가능
       - stateful: 규칙과 상관없이 반환된 트래픽을 자동으로 허용
       - 모든 규칙을 확인해 트래픽의 허가 여부를 결정
     - 네트워크 ACL
       - **서브넷에 설정**: 개별 인스턴스에 설정할 필요가 없다
       - 규칙 허용과 거부가 가능
       - stateless: 반환된 트래픽을 규칙에 따라 명시적으로 허용
       - 순서대로 규칙을 처리하면서 트래픽의 허가 여부를 결정
2. 인바운드 및 아웃바운드 설정과 잘 알려진 포트
   - 포트: 통신의 입구



### 8. VPC 엔드포인트: 다른 AWS 서비스 및 엔드포인트 서비스와 연결

1. VPC 엔드포인트란
   - VPC 내부에서 VPC 외부로 접속하기 위한 연결점을 제공하는 서비스
   - 인터넷 게이트웨이를 통하지 않고, VPC 외부에 잇는 서비스와 VPC를 직접 연결해주는 것이 엔드포인트 서비스
     - VPC를 사용하지 않는 대표적인 서비스: S3, DynamoDB
2. 인터페이스 엔드포인트와 게이트웨이 엔드포인트
   - VPC 엔드포인트는 가상 서비스로 확장성과 고가용성을 지원, 네트워크 트래픽에 대해 자동으로 스케일링
   - 인터페이스 엔드포인트: 네트워크 인터페이스로 구축하는 유형
   - 게이트웨이 엔드포인트: 라우팅 테이블에 설정된 내용을 라우팅하는 유형



### 9. VPC 연결: VPC와 VPC의 연결과 VPC와 VPN의 연결

1. VPC 연결
   - VPC끼리 연결하려면 VPC 피어링이라는 기능을 활성화해야 한다.
   - AWS 전용선 서비스: AWS Direct Connect, 가상 사설망 서비스: AWS VPN
2. 전용선과 가상 사설망
   - WAN(Wide Area Network): 네트워크와 네트워크를 연결해 커다란 네트워크를 구축하는 것
     - 본사와 지사, 지사와 지사 같이 일대일로 네트워크 연결
     - 전용선으로 연결하는 경우와 가상 사설망으로 연결하는 경우
3. AWS Direct Connect
   - AWS 네트워크에 전용선을 물리적으로 연결
4. AWS VPN
   - AWS 네트워크에 가상으로 전용선을 연결
5. 전송 게이트웨이
   - VPN이나 온프레미스 네트워크를 하나로 묶어서 서로 연결하는 접속점을 제공하는 서비스

 

